# План: Telegram-бот на Laravel с ИИ

## 1. С чего начать

### Шаг 1. Установить Laravel
```bash
composer create-project laravel/laravel . --prefer-dist
```
(В корне репозитория — точка в конце.)

### Шаг 2. Пакет для Telegram
Для Laravel удобно использовать **Nutgram** (современный, удобный API):
```bash
composer require nutgram/nutgram
```
Либо **telegram-bot-sdk**:
```bash
composer require telegram-bot-sdk/telegram-bot-sdk
```

### Шаг 3. Переменные окружения
В `.env`:
```env
TELEGRAM_BOT_TOKEN=ваш_токен_от_@BotFather
TELEGRAM_WEBHOOK_URL=  # для продакшена (HTTPS)
```

### Шаг 4. Архитектура бота
- **Консольная команда** для запуска (long polling или webhook).
- **Обработчики (Handlers)** — классы под команды и типы сообщений.
- **Слой ИИ** — отдельный сервис/интеграция с твоей библиотекой (подключишь позже).

Рекомендуемая структура:
```
app/
  Bot/
    Handlers/       # команды и обработчики сообщений
    Services/       # ИИ и прочая логика
  Console/
    Commands/
      TelegramBotCommand.php   # artisan telegram:run
```

### Шаг 5. Локальная разработка
- **Локально без HTTPS:** использовать **getUpdates (long polling)** — Docker не обязателен.
- **С webhook (HTTPS):** нужен туннель (ngrok, localtunnel) или развёрнутый сервер; Docker тут только для окружения приложения.

---

## 2. Как тестировать

### Юнит/фиче-тесты (PHPUnit)
- Мокать HTTP-клиент (запросы к Telegram API).
- Тестировать обработчики: на вход — объект сообщения/обновления, на выход — ответ бота.
- Тестировать ИИ-сервис отдельно (подставная реализация или мок).

### Ручное тестирование бота
1. **Long polling:** запуск `php artisan telegram:run` на своей машине, общение с ботом в Telegram.
2. **Webhook:** поднять приложение (локально или в Docker), выставить webhook на ngrok-URL и тестировать в Telegram.

### Интеграционные тесты
- Опционально: тесты против реального Telegram API (test-бот, отдельный токен), чтобы не лимитировать продакшен-бота.

---

## 3. Нужен ли Docker?

**Не обязателен** для старта:
- Laravel и бот отлично работают на локальном PHP (PHP 8.2+).
- Для long polling достаточно: `php artisan telegram:run` в терминале.

**Docker полезен, если:**
- Хочешь единое окружение (PHP/версии расширений) для себя и команды.
- Деплоишь в контейнеры или используешь Laravel Sail для БД, очередей и т.д.

**Рекомендация:** начать без Docker (Laravel + long polling), подключить ИИ-библиотеку, написать пару команд и тесты. Docker добавить позже при необходимости (например, через `php artisan sail:install`).

---

## 4. Краткий порядок действий

| # | Действие |
|---|----------|
| 1 | Установить Laravel в текущую папку |
| 2 | Установить пакет Telegram (Nutgram или telegram-bot-sdk) |
| 3 | Создать команду `telegram:run` и минимальный обработчик (например, /start) |
| 4 | Добавить в `.env` токен бота и запустить `php artisan telegram:run` |
| 5 | Подключить свою ИИ-библиотеку в отдельный сервис и вызывать из обработчиков |
| 6 | Покрыть обработчики и ИИ-сервис тестами |

Дальше можно добавить webhook, очередь заданий и Docker по мере надобности.
